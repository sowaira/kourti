SharedApp={};SharedApp.Views={};SharedApp.Models={};$('meta[name="csrf-token"]').length&&$.ajaxSetup({beforeSend:function(a){a.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))}});SharedApp.main={init:function(){},manageEscales:function(){$(".js-add-escale").click(function(){new SharedApp.Views.Escale});$(".js-escale-villes").each(function(a,b){var c=new Ville({id:$(b).val()});new SharedApp.Views.Escale({model:c})})},manageTels:function(){$(".js-add-tel").click(function(){new SharedApp.Views.UserTel});$(".js-user-tels").each(function(a,b){var c=new Tel({index:a,number:$(b).val()});new SharedApp.Views.UserTel({model:c})})},manageComments:function(a,b){$.ajax({type:"GET",url:"/comments?token="+a+"&class_name="+b,success:function(a){$(".js-comments").html("");if(void 0!==a.comment)for(var b=0;b<a.comment.length;b++){var c=new Comment({object:a.comment[b]});new SharedApp.Views.Comment({model:c})}},error:function(){alert("Sorry, there was a problem!")}})},submitComments:function(a,b){$(".js-comment-submit").click(function(){var c=$(".js-comment-text").val();$.ajax({type:"POST",url:"/comment",data:{text:c,class_name:b,token:a},success:function(){SharedApp.main.manageComments(a,b);$(".js-comment-text").val("")},error:function(){alert("Sorry, there was a problem!")}})})},submitNote:function(a){$(".js-like-submit").click(function(){$elm=$(this);var b=parseInt($elm.attr("data-type-action")),c=$elm.attr("data-"+a.toLowerCase()+"-token");0>b||b>1?alert("Sorry, there was a problem!"):$.ajax({type:"POST",url:"/like",data:{type_action:b,class_name:a,token:c},success:function(b){$elm.parents(".js-"+a.toLowerCase()).find(".js-like-submit").hide();$elm.parents(".js-"+a.toLowerCase()).find(".js-likes").html(b.likes);$elm.parents(".js-"+a.toLowerCase()).find(".js-dislikes").html(b.dislikes)},error:function(){alert("Sorry, there was a problem!")}})})},uploadImage:function(){$(".js-upload-photo").click(function(){$(".js-upload-photo-container .cloudinary_fileupload").click()});$(".js-upload-photo-container .cloudinary_fileupload").unsigned_cloudinary_upload("n2x0h8b1",{tags:"kourti"},{multiple:!0}).bind("cloudinarydone",function(a,b){$(".js-upload-photo-container").css("background-size","cover");$(".js-upload-photo-container").css("background-image","url("+b.result.url+")");$(".js-upload-photo-value").val(b.result.url);$(".js-upload-photo").show();$(".js-upload-photo-spinner").hide()}).bind("fileuploadprogress",function(){$(".js-upload-photo").hide();$(".js-upload-photo-spinner").show()})}};var Comment=Backbone.Model.extend({}),Tel=Backbone.Model.extend({}),Ville=Backbone.Model.extend({});SharedApp.Views.Comment=Backbone.View.extend({el:$(".js-comments"),template:JST["assets/js/core/templates/comment_item.html"],initialize:function(){this.render()},render:function(){var a;void 0!==this.model&&(a=this.model.attributes.object);$(this.el).append(this.template(a))}});$(".open-popup-link").magnificPopup({type:"inline",midClick:!0});SharedApp.Views.Escale=Backbone.View.extend({el:$(".js-escales"),template:JST["assets/js/core/templates/escale.html"],events:{"click .js-remove-escale":"removeEscale"},initialize:function(){this.render()},render:function(){var a;void 0!==this.model&&(a=this.model.get("id"));obj={selected_ville_id:a};$(this.el).append(this.template(obj))},removeEscale:function(a){$this=$(a.target);$this.parents(".js-escale").remove()}});SharedApp.Views.Shared=Backbone.View.extend({initialize:function(){this.manageSelects();this.manageValidationForm();return!1},manageSelects:function(){$("select").select2({placeholder:"Select a state",allowClear:!0});$("select").addClass("width-1")},manageValidationForm:function(){$("form").validationEngine("attach",{promptPosition:"topLeft",scroll:!1})}});SharedApp.Views.Timepicker=Backbone.View.extend({el:$("body"),template:JST["assets/js/core/templates/timepicker.html"],events:{"click .js-tp-plus-time":"plusTime","click .js-tp-minus-time":"minusTime","click .js-tp-set-time":"setTime","click .js-tp-cancel-time":"cancelTime"},initialize:function(){self=this;this.render()},render:function(){$(this.el).append(this.template());$(".js-time").click(function(){el_time=$(this);$.magnificPopup.open({items:{src:".js-time-picker"},type:"inline"})})},setTime:function(){el_time.val($(".js-tp-hour").val()+":"+$(".js-tp-min").val());el_time.validationEngine("validate");$.magnificPopup.close({items:{src:".js-time-picker"}})},cancelTime:function(){$.magnificPopup.close({items:{src:".js-time-picker"}})},plusTime:function(a){$this=$(a.target);$input=$this.parents(".js-tp-time-container").find(".js-tp-time");var b=23;$input.hasClass("js-tp-min")&&(b=59);var c=parseInt($input.val());b>c?c++:c=0;$input.val(c)},minusTime:function(a){$this=$(a.target);$input=$this.parents(".js-tp-time-container").find(".js-tp-time");var b=23;$input.hasClass("js-tp-min")&&(b=59);var c=parseInt($input.val());1>c?c=b:c--;$input.val(c)}});SharedApp.Views.UserTel=Backbone.View.extend({el:$(".js-tels"),template:JST["assets/js/core/templates/tel.html"],events:{"click .js-remove-tel":"removeTel"},initialize:function(){this.render()},render:function(){var a,b;if(void 0!==this.model){a=this.model.get("number");b=this.model.get("index")}obj={index:b,number:a};$(this.el).append(this.template(obj))},removeTel:function(a){$this=$(a.target);$this.parents(".js-tel").remove()}});